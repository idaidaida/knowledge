<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title
      th:text="${filterUser} != null ? ${filterUser} + ' の投稿' : 'ホーム'"
    >
      ホーム
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header
      class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-gray-200"
    >
      <div
        class="mx-auto max-w-md w-full px-4 h-12 flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="#2563eb"
            class="w-5 h-5"
          >
            <path
              d="M11.47 3.84a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06L12 5.06 5.03 12l-.53-.53c-.3-.3-.3-.79 0-1.09l7-7.04z"
            />
            <path
              d="M4.5 12.75l7.28-7.28a.75.75 0 0 1 1.06 0l6.66 6.66v6.62a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 18.75v-6z"
            />
          </svg>
          <h1
            class="text-base font-semibold"
            th:text="${filterUser} != null ? ${filterUser} + ' の投稿' : 'ホーム'"
          >
            ホーム
          </h1>
        </div>
        <a href="/logout" class="text-sm text-gray-600" title="ログアウト"
          >ログアウト</a
        >
      </div>
    </header>

    <main class="mx-auto max-w-md w-full px-0 pb-28 pt-0">
      <div
        th:if="${error}"
        class="mb-3 rounded-md border border-red-200 bg-red-50 text-red-800 text-sm px-3 py-2"
        th:text="${error}"
      ></div>

      <section>
        <div
          th:if="${#lists.isEmpty(posts)}"
          class="text-center text-gray-500 text-sm py-8"
        >
          投稿はまだありません
        </div>

        <!-- Compact List Style -->
        <ul class="bg-white divide-y divide-gray-200 mt-2">
          <li th:each="post : ${posts}">
            <a
              class="flex gap-3 items-start p-3 active:bg-gray-50"
              th:href="@{'/posts/' + ${post.id}}"
            >
              <!-- Avatar -->
              <img
                class="w-9 h-9 rounded-full object-cover bg-gray-200 flex-none"
                th:src="@{'/img/users/' + ${post.username} + '.svg'}"
                onerror="this.onerror=null;this.src='/img/users/_default.svg';"
                alt="avatar"
              />

              <!-- Content -->
              <div class="min-w-0 flex-1">
                <div class="text-xs text-gray-500 flex items-center gap-2">
                  <button
                    type="button"
                    class="text-gray-700 underline underline-offset-2"
                    onclick="event.stopPropagation(); location.href=this.dataset.href;"
                    th:attr="data-href=@{'/users/' + ${post.username}}"
                    th:text="${post.username}"
                  >
                    username
                  </button>
                  <span class="mx-1">·</span>
                  <span
                    th:text="${#dates.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"
                  ></span>
                </div>
                <div
                  class="mt-0.5 text-[15px] font-semibold text-gray-900 overflow-hidden"
                  style="
                    -webkit-line-clamp: 1;
                    display: -webkit-box;
                    -webkit-box-orient: vertical;
                  "
                  th:text="${post.title} ?: '記事'"
                ></div>
                <div
                  class="mt-0.5 text-sm text-gray-700 overflow-hidden whitespace-pre-line"
                  style="
                    -webkit-line-clamp: 2;
                    display: -webkit-box;
                    -webkit-box-orient: vertical;
                  "
                  th:text="${post.content}"
                ></div>
              </div>

              <!-- Thumb (optional) -->
              <img
                th:if="${!#strings.isEmpty(post.imageUrl)}"
                class="w-16 h-16 rounded-md object-cover bg-gray-100 flex-none"
                th:src="${post.imageUrl}"
                alt="thumb"
              />
            </a>
          </li>
        </ul>
      </section>
    </main>

    <!-- Bottom Navigation -->
    <nav
      class="fixed bottom-0 inset-x-0 z-20 bg-white/95 backdrop-blur border-t border-gray-200"
    >
      <div
        class="mx-auto max-w-md w-full px-8 h-14 grid grid-cols-3 items-center text-xs text-gray-600"
      >
        <a
          href="/"
          class="justify-self-start inline-flex items-center gap-2 text-blue-600"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
            class="w-5 h-5"
          >
            <path
              d="M11.47 3.84a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06L12 5.06 5.03 12l-.53-.53c-.3-.3-.3-.79 0-1.09l7-7.04z"
            />
            <path
              d="M4.5 12.75l7.28-7.28a.75.75 0 0 1 1.06 0l6.66 6.66v6.62a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 18.75v-6z"
            />
          </svg>
          <span>ホーム</span>
        </a>
        <a
          href="/posts/new"
          class="justify-self-center -mt-8 inline-flex items-center justify-center w-14 h-14 rounded-full bg-blue-600 text-white shadow-lg active:bg-blue-700"
          aria-label="投稿する"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="w-7 h-7"
          >
            <path
              fill-rule="evenodd"
              d="M12 4.5a.75.75 0 01.75.75v6h6a.75.75 0 010 1.5h-6v6a.75.75 0 01-1.5 0v-6h-6a.75.75 0 010-1.5h6v-6A.75.75 0 0112 4.5z"
              clip-rule="evenodd"
            />
          </svg>
        </a>
        <a
          th:href="@{'/users/' + ${session.loginUser}}"
          class="justify-self-end inline-flex items-center gap-2"
        >
          <img
            class="w-5 h-5 rounded-full object-cover bg-gray-200"
            th:src="@{'/img/users/' + ${session.loginUser} + '.svg'}"
            onerror="this.onerror=null;this.src='/img/users/_default.svg';"
            alt="me"
          />
          <span>自分</span>
        </a>
      </div>
    </nav>
  </body>
</html>
